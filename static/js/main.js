!async function(t){var s,n=function(){return new Promise(s=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{const t=new MediaRecorder(e),a=[];t.addEventListener("dataavailable",e=>{a.push(e.data)});s({start:()=>{t.start()},stop:()=>new Promise(n=>{t.addEventListener("stop",()=>{var e=new Blob(a),t=URL.createObjectURL(e);const s=new Audio(t);n({audioBlob:e,audioUrl:t,play:()=>{s.play()}})}),t.stop()})})})})},a=await n(),o=document.getElementById("msgPanelBody"),i=document.getElementById("inputFld"),l=document.getElementById("sendButton"),d=document.getElementById("skipButton"),e=document.getElementById("selectImage"),r=document.getElementById("fileInput"),c='<i class="fa fa-telegram fa-2x"></i>',g='<i class="fa fa-microphone fa-2x"></i>',u={icon:{ALERT:'<i class="fa fa-lightbulb-o"></i>',LOAD:'<i class="fa fa-circle-o-notch fa-spin"></i>'},alert:'<div class="row alert"> \t\t\t        <div class="msg alert"> \t\t\t            <p><i class="fa fa-lightbulb-o"></i> {msg}</p> \t\t\t        </div>\t\t\t    </div>',customAlert:'<div class="row alert"> \t\t\t\t\t        <div class="msg alert"> \t\t\t\t\t            <p>{ico} {msg}</p> \t\t\t\t\t        </div>\t\t\t\t\t    </div>',they:'<div class="row they">\t\t\t\t\t<div class="msg they">\t\t\t\t\t\t<p><strong>Stranger:</strong></p>\t\t\t\t\t\t<div>{msg}</div>\t\t\t\t\t</div>\t\t\t\t</div>',theyImage:'<div class="row they">     <div class="msg they">      <p><strong>Stranger:</strong></p>      <img         src={imageBase64}         class="image-preview"      />      </div>    </div>',theyAudio:'<div class="row they">     <div class="msg they">      <p><strong>Stranger:</strong></p>      <audio controls>        <source src={audioBase64} type="audio/mpeg">      </audio>      </div>    </div>',me:'<div class="row me">\t\t\t\t    <div class="msg me">\t\t\t\t        <p><strong>Me:</strong></p>\t\t\t\t        <div>{msg}</div>\t\t\t\t    </div>\t\t\t\t</div>',meImage:'<div class="row me">       <div class="msg me">        <p><strong>Me:</strong></p>        <img           src={imageBase64}           class="image-preview"        />      </div>    </div>',meAudio:'<div class="row me">     <div class="msg me">      <p><strong>Me:</strong></p>      <audio controls>        <source src={audioBase64} type="audio/mpeg" style="background-color: transparent;"      </audio>      </div>    </div>'},m=16,p=13,f=10,v={flags:{holding:{shift:!1},skip:!1,alone:!0},render:{message:function(e,t,s){e&&t&&(e!=u.alert&&e!=u.customAlert&&(t=-1!=t.indexOf("\n")?"<p>"+(t=t.split("\n")).join("</p><p>")+"</p>":(console.log("Tem \n"),"<p>"+t+"</p>")),t=e.replace("{msg}",t),e==u.customAlert&&s&&(t=t.replace("{ico}",s)),t=$(t),$(o).append(t))},fileMessage:function(e,t,s){var n=null;"IMAGE"===s&&(n=e.replace("{imageBase64}",t)),"AUDIO"===s&&(n=e.replace("{audioBase64}",t)),$(o).append(n)},clear:function(){o.innerHTML=""},fileMsg:{meImage:function(e){v.render.fileMessage(u.meImage,e,"IMAGE")},meAudio:function(e){v.render.fileMessage(u.meAudio,e,"AUDIO")},theyImage:function(e){v.render.fileMessage(u.theyImage,e,"IMAGE")},theyAudio:function(e){v.render.fileMessage(u.theyAudio,e,"AUDIO")}},msg:{me:function(e){v.render.message(u.me,e)},they:function(e){v.render.message(u.they,e)},alert:function(e,t){t=null==t?u.icon.ALERT:t,v.render.message(u.customAlert,e,t)}}},scroll:{top:function(){o.scrollTop=0},bottom:function(){o.scrollTop=o.scrollHeight}},socket:{_namespace:"/chat",events:{PAIRFOUND:"pairfound",PAIRLOST:"pairlost",ALERT:"alert",SKIP:"skip"},connect:function(){console.log("Initializing socket.");var e=t.location.href.substr(0,t.location.href.indexOf(":")),e=(e+="://")+document.domain+":"+location.port+this._namespace;console.log("Where: ",e),s=io.connect(e),console.log("Socket up: ",s)},send:function(e){s.send(e)},receive:function(e){"TEXT"===e.type&&v.render.msg.they(e.msgString),"IMAGE"===e.type&&v.render.fileMsg.theyImage(e.fileBase64),"AUDIO"===e.type&&v.render.fileMsg.theyAudio(e.fileBase64),v.scroll.bottom()},alert:function(e,t){console.log("alert: ",e),v.render.msg.alert(e)},skip:function(){console.log("Called skip."),s.emit(v.socket.events.SKIP)},onPairFound:function(e){console.log("onPairFound"),v.flags.alone=!1,v.render.clear(),v.render.msg.alert(e.msg),v.scroll.bottom(),v.input.enable()},onPairLost:function(e){console.log("pairlost"),v.flags.alone=!0,v.render.msg.alert(e.msg),v.scroll.bottom(),v.input.disable()}},input:{disable:function(){i.disabled="disabled",$(i).addClass("disabled"),l.disabled=!0,$(l).addClass("disabled"),e.disabled=!0,$(e).addClass("disabled")},enable:function(){i.disabled=!1,$(i).removeClass("disabled"),l.disabled=!1,$(l).removeClass("disabled"),e.disabled=!1,$(e).removeClass("disabled")},skip:{enable:function(){var e=$(d);e.hasClass("disabled")&&e.removeClass("disabled")},disable:function(){var e=$(d);e.hasClass("disabled")||e.addClass("disabled")}}},onKeyUp:function(e){(l.innerHTML="")===e.target.value?$(l).append(g):$(l).append(c),e.which==m&&(v.flags.holding.shift=!1),e.which!=p&&e.which!=f||v.flags.holding.shift||(e.preventDefault(),v.sendMessage())},onKeyDown:function(e){e.which==m&&(v.flags.holding.shift=!0)},sendMessage:function(){var e=i.value;i.value="",v.render.msg.me(e),v.socket.send({msgString:e,type:"TEXT"}),v.scroll.bottom()},sendImageMessage:async function(e){},sendAudioMessage:function(e){const t=new FileReader;t.readAsDataURL(e.audioBlob),t.onloadend=function(){var e=t.result;v.render.fileMsg.meAudio(e),v.socket.send({fileBase64:e,type:"AUDIO"})}},skipConversation:function(){var e=$(d);e.hasClass("confirm")&&(e.removeClass("confirm"),e.addClass("skip")),v.flags.skip=!1,v.flags.alone=!1,v.socket.skip(),v.render.clear(),v.render.msg.alert("Connecting to someone...",u.icon.LOAD),v.scroll.bottom(),v.input.disable()},sendButtonClicked:async function(e){var t=i.getAttribute("placeholder");"Type a message"===t&&""===i.value?(i.setAttribute("placeholder","Recording..."),i.disabled=!0,l.innerHTML="",$(l).append(c),a.start()):"Recording..."===t&&""===i.value?(t=await a.stop(),a=await n(),i.setAttribute("placeholder","Type a message"),i.disabled=!1,v.sendAudioMessage(t)):(v.sendMessage(e.target.value),l.innerHTML="",$(l).append(g))},handleSelectImage:function(){r.click()},handleFileChange:function(e){const t=new FileReader;t.onload=()=>{v.render.fileMsg.meImage(t.result),v.socket.send({fileBase64:t.result,type:"IMAGE"})},t.onerror=e=>{console.error(e)},t.readAsDataURL(e.target.files[0]),v.sendImageMessage(e.target.files[0])},skipButtonClicked:function(){var e=$(d);v.flags.alone?v.skipConversation():e.hasClass("confirm")?(v.flags.skip=!1,v.skipConversation()):(v.flags.skip=!0,e.hasClass("skip")&&e.removeClass("skip"),e.addClass("confirm"))},initialize:function(){console.log("Initializing."),i.addEventListener("keydown",v.onKeyDown),i.addEventListener("keyup",v.onKeyUp),d.addEventListener("click",v.skipButtonClicked),e.addEventListener("click",v.handleSelectImage),r.addEventListener("change",v.handleFileChange),l.addEventListener("click",v.sendButtonClicked),t.addEventListener("beforeunload",function(e){var t="Are you sure you want to leave? :/";return e.preventDefault(),e.returnValue=t}),v.socket.connect(),s.on("message",v.socket.receive),s.on(v.socket.events.PAIRFOUND,function(e){v.socket.onPairFound(e)}),s.on(v.socket.events.PAIRLOST,function(e){v.socket.onPairLost(e)}),s.on(v.socket.events.ALERT,function(e){console.log("alert"),e.type?v.socket.alert(e.msg,e.type):v.socket.alert(e.msg),v.scroll.bottom()}),v.input.disable(),v.render.msg.alert("Connecting to someone...",u.icon.LOAD)}};v.initialize(),t.expose={Chat:v,MessageTemplate:u,sio:s}}(window);